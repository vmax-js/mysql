<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title></title>

		<link rel="stylesheet" href="../static/css/style.css">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
		<style>
			.mainX{
				 width: 100%;
				 height: 100px;
				 margin-top: 0;
			 }
			 .imgH{max-height: 600px;}
		</style>
	</head>
	<body>

		<!-- 导航栏-->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<a class="navbar-brand" href="#">
				<img src="../static/img/bootstrap-solid.svg" width="30" height="30" class="d-inline-block align-top" alt="">
				BLAST
			</a>
			<a class="navbar-brand" href="https://www.ncbi.nlm.nih.gov/" target="_Blank">NCBI</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText"
			 aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarText">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item active">
						<a class="nav-link" href="#" target="_Blank">Home <span class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&PAGE_TYPE=BlastSearch&LINK_LOC=blasthome"
						 target="_Blank">Blastn</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastp&PAGE_TYPE=BlastSearch&LINK_LOC=blasthome"
						 target="_Blank">blastp</a>
					</li>
				</ul>
				<span class="navbar-text">
					<a class="nav-link" href="blasthistory" target="_Blank" id="username">Historical information</a>
				</span>
			</div>
		</nav>

		<!-- 轮播图-->
		<div class="mainX">
			<div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
				<ol class="carousel-indicators">
					<li data-target="#carouselExampleFade" data-slide-to="First slide" class="active"></li>
					<li data-target="#carouselExampleFade" data-slide-to="Second slide"></li>
				</ol>
				<div class="carousel-inner">
					<div class="carousel-item active">
						<img class="d-block w-100  " src="../static/img/q2.jpg" alt="First slide">
						<div class="carousel-caption d-none d-md-block">
							<h3>NCBI Blast on line</h3>
							<p>BLAST finds regions of similarity between biological sequences.</p>
						</div>
					</div>
					<div class="carousel-item">
						<img class="d-block w-100 " src="../static/img/q1.jpg" alt="Second slide">
						<div class="carousel-caption d-none d-md-block">
							<h3>Basic Local Alignment Search Tool</h3>
							<p>The program compares nucleotide or protein sequences to sequence databases and calculates the statistical
								significance. </p>
						</div>
					</div>

				</div>
				<a class="carousel-control-prev" href="#carouselExampleFade" role="button" data-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="sr-only">Previous</span>
				</a>
				<a class="carousel-control-next" href="#carouselExampleFade" role="button" data-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a>
			</div>
		</div>


		<!-- 表单-->
		<div class="main" style="margin-top: 580px;" id="showForm">
			<div style="color: black;text-align: left;">
				<h1>Blast Online</h1>
			</div>
			<form action="" method="post" id="ajaxForm">
				<!--
				<div class="lable">
					<input type="text" class="text" value="blastn/blastp" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'blastn/blastp';}"
					 id="active">
			
					<input type="text" class="text" value="database:nt" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'database:nt';}">
				</div>
				<div class="clear"> </div>
				-->
				<div class="lable-2">
					<input type="text" name="pro" class="text" value="blastn/blastp" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'blastn/blastp';}"
					 id="active">

					<input id="DB" type="text" name="db" class="text" value="database:nt" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'database:nt';}">
					<input id="SEQ" type="text" name="seq" class="text" value="sequence/GI" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'sequence/GI';}">
					<!--<input type="password" class="text" value="Password " onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Password ';}">-->
				</div>
				<div class="clear"> </div>
				<h3>By creating an account, you agree to our <span><a href="#">Blastn & Blastp</a> </span></h3>
				<div class="submit">
					<!-- <input type="submit" onclick="myBlast" value="BLAST"> -->
					<button type="button" style="width: 94%;height: 60px;line-height: 60px;float: left;background-color: #40A46F;border: solid 0px red;color: white; font-size: 20px;"
					 onclick="myBlast()">BLAST</biutton>


				</div>
				<div class="clear"> </div>
				<div style="margin-top: 20px;"></div>
			</form>
		</div>

		<!-- loading -->
		<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static'>
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="myModalLabel">提示</h4>
					</div>
					<div class="modal-body">
						blast大约需要5分钟左右，请稍候...<span id="result"></span>
					</div>
				</div>
			</div>
		</div>

		<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>-->
		<script src="../static/js/jquery-3.3.1.min.js"></script>
		<script src="../static/js/jquery.form.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
		<script>
			$(document).ready(function() {
				$('#carouselExampleFade').carousel({
					interval: 5000
				}); //每隔5秒自动轮播 
			});
			var login = " "
			var id = 0
			window.onload = function() {
				var s=get('blastUser',1000*60*30);//过期时间为0.5H
				var i=get('blastId',1000*60*30);//过期时间为0.5H
				console.log(s)
				if(s==null){
					document.getElementById("username").innerHTML="Historical information";
				}
				else{
					document.getElementById("username").innerHTML=s+" Historical information";
					login=s;id=i;
				}
			}
			
			//超时设置
			function set(key, value) {
				var curTime = new Date().getTime();
				localStorage.setItem(key, JSON.stringify({
					data: value,
					time: curTime
				}));
			}
			
			function get(key, exp) {
				console.log("s",key)
				var data = localStorage.getItem(key);
				var dataObj = JSON.parse(data);
				if (new Date().getTime() - dataObj.time > exp) {
					console.log('信息已过期');
					//alert("信息已过期 请重新登陆")
					return null;
				} else {
					//console.log("data="+dataObj.data);
					//console.log(JSON.parse(dataObj.data));
					var dataObjDatatoJson = dataObj.data
					console.log(dataObjDatatoJson)
					return dataObjDatatoJson
				}
			}


			function test() {
				var s = localStorage.getItem("blastdata");
				var s1 = JSON.parse(s); //将字符串转为json
				console.log(s1.E_VALUE_THRESH);
			}

			function myBlast1() {
				window.location.href = "blastRes"
			}

			function myBlast() {
				$('#loading').modal('show');
				var pro = document.getElementById("active").value;
				var db = document.getElementById("DB").value;
				var seq = document.getElementById("SEQ").value;
				console.log(pro, db, seq);
				//游客身份访问
				if (login == " ") {
					console.log("游客")
					$.ajax({
						type: "post",
						async: true,
						url: "http://127.0.0.1:5000/blast/getblast",
						data: {
							"pro": pro,
							"db": db,
							"seq": seq
						},
						dataType: "json",
						success: function(data) {
							$('#loading').modal('hide');
							console.log(JSON.stringify(data));
							//存储数据
							localStorage.setItem("blastdata", JSON.stringify(data)); //先将json转为字符串存储
							//跳转页面
							window.location.href = "blastRes" //在template模板中这里要写路由的名称

						},
						error: function(result) {
							console.log(result);

							alert("未连接到服务器");
							$('#loading').modal('hide');
						}

					});
				}
				//登陆状态
				else {
					console.log("用户", login, id)
					$.ajax({
						type: "post",
						async: true,
						url: "http://127.0.0.1:5000/blast/getblastDB",
						data: {
							"pro": pro,
							"db": db,
							"seq": seq,
							"id": id,
							"user": login
						},
						dataType: "json",
						success: function(data) {
							$('#loading').modal('hide');
							console.log(JSON.stringify(data));
							//存储数据
							localStorage.setItem("blastdata", JSON.stringify(data)); //先将json转为字符串存储
							//跳转页面
							window.location.href = "blastRes" //在template模板中这里要写路由的名称

						},
						error: function(result) {
							console.log(result);

							alert("未连接到服务器");
							$('#loading').modal('hide');
						}

					});
				}


			}
		</script>
	</body>

</html>
